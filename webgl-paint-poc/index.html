<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebGL Symmetry Paint PoC</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .demo-link {
        display: block;
        background: #007bff;
        color: white;
        text-decoration: none;
        padding: 15px 30px;
        border-radius: 5px;
        text-align: center;
        font-size: 18px;
        margin: 20px 0;
        transition: background 0.3s;
      }
      .demo-link:hover {
        background: #0056b3;
      }
      .demo-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .demo-button:hover {
        background: #0056b3;
      }
      .demo-button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      .demo-section {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 20px;
        margin: 20px 0;
      }
      .stroke-item {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 5px 10px;
        font-size: 12px;
        cursor: pointer;
      }
      .stroke-item:hover {
        background: #e9ecef;
      }
      .stroke-item.selected {
        background: #007bff;
        color: white;
      }
      .info {
        background: #e7f3ff;
        border: 1px solid #b8daff;
        border-radius: 4px;
        padding: 15px;
        margin: 15px 0;
      }
      .status {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
      }
      #app {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      #paint-canvas {
        border: 2px solid #333;
        background-color: white;
        cursor: crosshair;
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>WebGL Symmetry Paint PoC</h1>
      
      <div class="status">
        <h3>âœ… Task 6.3 Implementation Complete</h3>
        <p><strong>Real-time Input Processing & Drawing Integration</strong> - All tests passing (285/285)</p>
      </div>
      
      <div class="info">
        <h3>Step 4.2: 8-Axis Radial Symmetry Integration</h3>
        <p>The symmetric drawing functionality has been implemented and integrated:</p>
        <ul>
          <li><strong>âœ… Mathematical Foundation</strong> - Complete 8-axis radial symmetry transforms</li>
          <li><strong>âœ… Symmetry Renderer</strong> - Generate 8 symmetric strokes from single input</li>
          <li><strong>âœ… WebGL Integration</strong> - Seamless integration with existing drawing engine</li>
          <li><strong>âœ… Configuration System</strong> - Toggle symmetry on/off with SymmetryConfig</li>
          <li><strong>âœ… Visual Testing</strong> - 34 comprehensive tests for symmetry functions</li>
          <li><strong>âœ… Mathematical Accuracy</strong> - Distance preservation and geometric correctness</li>
        </ul>
      </div>

      <div class="demo-section">
        <h2>Interactive Paint Canvas (1024x1024)</h2>
        <div style="text-align: center; margin: 20px 0;">
          <canvas id="paint-canvas" width="1024" height="1024" style="max-width: 100%; height: auto; border: 2px solid #ddd; border-radius: 4px; background: white; cursor: crosshair;"></canvas>
        </div>
        
        <div style="text-align: center; margin: 20px 0; background: #e8f4fd; padding: 15px; border-radius: 8px;">
          <h3 style="margin-top: 0; color: #0066cc;">ğŸ¨ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æç”»ãƒ¢ãƒ¼ãƒ‰ - Task 6.3 å®Œäº†</h3>
          <p style="margin: 10px 0; font-weight: bold; color: #333;">ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒãƒ»ãƒšãƒ³ã§ç›´æ¥æç”»ã§ãã¾ã™ï¼</p>
          
          <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: center; margin: 15px 0;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-weight: bold;">å¯¾ç§°æç”»:</label>
              <input type="checkbox" id="live-symmetry-enabled" checked>
              <span>8è»¸å¯¾ç§° ON/OFF</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-weight: bold;">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º:</label>
              <input type="checkbox" id="debug-enabled" checked>
              <span>çµ±è¨ˆæƒ…å ±è¡¨ç¤º</span>
            </div>
          </div>
          
          <!-- Task 6.6: Input Correction Controls -->
          <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 15px 0;">
            <h4 style="margin-top: 0; color: #495057;">ğŸ¨ å…¥åŠ›è£œæ­£è¨­å®š (Task 6.6)</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 10px 0;">
              <!-- Pressure Correction -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ç­†åœ§è£œæ­£:</label>
                <input type="checkbox" id="pressure-correction-enabled" checked>
                <span>ON/OFF</span>
              </div>
              
              <!-- Smoothing Enable -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°:</label>
                <input type="checkbox" id="smoothing-enabled" checked>
                <span>ON/OFF</span>
              </div>
              
              <!-- Pen Thickness Slider -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ãƒšãƒ³ã®å¤ªã•:</label>
                <input type="range" id="pen-thickness-slider" min="0.5" max="50" step="0.1" value="2.0" style="width: 80px;">
                <span id="pen-thickness-value">2.0px</span>
              </div>
              
              <!-- Smoothing Strength Slider -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å¼·åº¦:</label>
                <input type="range" id="smoothing-strength-slider" min="0.0" max="1.0" step="0.1" value="0.3" style="width: 80px;">
                <span id="smoothing-strength-value">0.3</span>
              </div>
              
              <!-- Smoothing Method -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°æ–¹æ³•:</label>
                <select id="smoothing-method-select" style="padding: 4px; border-radius: 4px; border: 1px solid #ccc;">
                  <option value="linear" selected>Linear (é«˜é€Ÿ)</option>
                  <option value="catmull-rom">Catmull-Rom (é«˜å“è³ª)</option>
                </select>
              </div>
              
              <!-- Real-time Mode -->
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: bold;">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ¼ãƒ‰:</label>
                <input type="checkbox" id="realtime-mode-enabled" checked>
                <span>é€Ÿåº¦å„ªå…ˆ</span>
              </div>
            </div>
            
            <!-- Quality Metrics Display -->
            <div style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
              <label style="font-weight: bold;">å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º:</label>
              <input type="checkbox" id="quality-metrics-enabled">
              <span>è£œæ­£åŠ¹æœã‚’è¡¨ç¤º</span>
            </div>
            
            <div id="quality-metrics-display" style="display: none; background: #e9ecef; padding: 10px; border-radius: 4px; margin-top: 10px; font-family: monospace; font-size: 12px;">
              <div>ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°æ”¹å–„åº¦: <span id="smoothness-improvement">--</span></div>
              <div>ç­†åœ§å®‰å®šæ€§: <span id="pressure-stability">--</span></div>
              <div>ãƒ‡ãƒ¼ã‚¿å¿ å®Ÿåº¦: <span id="data-fidelity">--</span></div>
              <div>å‡¦ç†æ¯”: <span id="processing-ratio">--</span></div>
            </div>
          </div>
          
          <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0;">
            <button id="clear-live-canvas" class="demo-button">ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢</button>
            <button id="toggle-symmetry" class="demo-button">å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
          </div>
        </div>
        
        <h2>Static Test Canvas (1024x1024)</h2>
        <div style="text-align: center; margin: 20px 0;">
          <canvas id="test-canvas" width="1024" height="1024" style="max-width: 100%; height: auto; border: 2px solid #ddd; border-radius: 4px; background: white;"></canvas>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
          <button id="render-all" class="demo-button">Render All Test Strokes</button>
          <button id="render-lines" class="demo-button">Render as Lines</button>
          <button id="render-points" class="demo-button">Render as Points</button>
          <button id="clear-canvas" class="demo-button">Clear Canvas</button>
        </div>
        
        <div style="text-align: center; margin: 20px 0; border-top: 2px solid #007bff; padding-top: 15px;">
          <h3>çµ±åˆæç”»ãƒ†ã‚¹ãƒˆ</h3>
          
          <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: center; margin: 15px 0;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-weight: bold;">å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰:</label>
              <input type="checkbox" id="symmetry-enabled" checked>
              <span>8è»¸å¯¾ç§°ON/OFF</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-weight: bold;">è‰²è¨­å®š:</label>
              <select id="color-select" style="padding: 5px; border-radius: 3px; border: 1px solid #ddd;">
                <option value="black">é»’</option>
                <option value="red">èµ¤</option>
                <option value="blue">é’</option>
                <option value="green">ç·‘</option>
                <option value="orange">ã‚ªãƒ¬ãƒ³ã‚¸</option>
                <option value="purple">ç´«</option>
              </select>
            </div>
          </div>
          
          <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0;">
            <button id="draw-line" class="demo-button">ç›´ç·š</button>
            <button id="draw-curve" class="demo-button">æ›²ç·š</button>
            <button id="draw-arc" class="demo-button">å††å¼§</button>
            <button id="draw-multi" class="demo-button">è¤‡æ•°ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯</button>
          </div>
        </div>
      </div>
      
      <div id="status" class="info">
        <h3>Status</h3>
        <p>Ready to render. Click any button above to test the drawing functionality.</p>
      </div>

      <div class="info">
        <h3>ãƒ†ã‚¹ãƒˆæ–¹æ³•:</h3>
        <ul>
          <li><strong>è‰²é¸æŠ</strong> - selectã§è‰²ã‚’é¸æŠ</li>
          <li><strong>å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰</strong> - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§8è»¸å¯¾ç§°ã®ON/OFF</li>
          <li><strong>ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»</strong> - ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§è¨­å®šã«å¾“ã£ã¦æç”»</li>
          <li><strong>8è»¸å¯¾ç§°</strong> - å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰ONã§ç¾ã—ã„ä¸‡è¯é¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèª</li>
          <li><strong>æ•°å­¦çš„æ­£ç¢ºæ€§</strong> - ä¸­å¿ƒ(512,512)ã‹ã‚‰ç­‰è·é›¢ã€45åº¦é–“éš”</li>
        </ul>
      </div>

      <div class="info">
        <h3>Implementation Details:</h3>
        <ul>
          <li><strong>Mathematical Foundation</strong> - 8-axis radial symmetry using reflection matrices</li>
          <li><strong>Transformation Functions</strong> - Point and stroke transformations with center preservation</li>
          <li><strong>Symmetry Renderer</strong> - renderStrokeWithSymmetry, generateSymmetricStrokes</li>
          <li><strong>WebGL Integration</strong> - Seamless integration with existing drawing pipeline</li>
          <li><strong>Test Coverage</strong> - 34 symmetry tests + 125 existing tests = 159 total tests passing</li>
          <li><strong>Visual Verification</strong> - Interactive buttons to test all symmetry patterns</li>
          <li><strong>Mathematical Accuracy</strong> - Distance preservation, angle correctness, consistency tests</li>
        </ul>
      </div>

      <p style="text-align: center; margin-top: 30px;">
        <em>Use the interactive demo above to visually confirm the drawing functionality works as expected.</em>
      </p>
    </div>

    <script type="module">
        // Import our WebGL modules
        import { initializeRenderer, renderTestPattern, renderStrokes, renderStrokesAsPoints, 
                clearCanvas, setDrawingColor, renderStroke, cleanupRenderer } from './src/webgl/renderer.js';
        import { allTestStrokes, horizontalLineStroke, verticalLineStroke, diagonalLineStroke,
                arcStroke, complexCurveStroke, spiralStroke, zigzagStroke } from './src/data/testStrokes.js';
        // Import symmetry renderer
        import { renderStrokeWithSymmetry, renderStrokesWithSymmetry } from './src/symmetry/symmetryRenderer.js';
        // Import Paint App Factory
        import { PaintAppFactory } from './src/app/PaintAppFactory.js';

        let renderer;
        let paintApp;

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            statusEl.innerHTML = `<h3>Status</h3><p style="color: ${type === 'error' ? '#721c24' : type === 'success' ? '#155724' : '#004085'};">${message}</p>`;
        }

        // è‰²è¨­å®šã‚’é©ç”¨
        function applyColorSetting() {
            const colorSelect = document.getElementById('color-select');
            const colorName = colorSelect.value;
            
            const colors = {
                black: [0, 0, 0, 1],
                red: [1, 0, 0, 1],
                blue: [0, 0, 1, 1],
                green: [0, 1, 0, 1],
                orange: [1, 0.5, 0, 1],
                purple: [0.8, 0, 0.8, 1]
            };
            
            if (colors[colorName]) {
                setDrawingColor(renderer, colors[colorName][0], colors[colorName][1], colors[colorName][2], colors[colorName][3]);
            }
        }

        // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã®çµ±åˆé–¢æ•°
        function drawStroke(strokeType) {
            if (!renderer) {
                updateStatus('ã‚¨ãƒ©ãƒ¼: ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            // è‰²è¨­å®šã‚’é©ç”¨
            applyColorSetting();
            
            // å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’å–å¾—
            const symmetryEnabled = document.getElementById('symmetry-enabled').checked;
            const symmetryConfig = {
                enabled: symmetryEnabled,
                axisCount: 8,
                centerPoint: { x: 512, y: 512 }
            };

            let strokes = [];
            
            // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            switch (strokeType) {
                case 'line':
                    strokes = [horizontalLineStroke];
                    break;
                    
                case 'curve':
                    strokes = [complexCurveStroke];
                    break;
                    
                case 'arc':
                    strokes = [arcStroke];
                    break;
                    
                case 'multi':
                    strokes = [horizontalLineStroke, diagonalLineStroke];
                    break;
            }

            try {
                clearCanvas(renderer);
                if (symmetryEnabled) {
                    renderStrokesWithSymmetry(renderer, strokes, symmetryConfig);
                    updateStatus(`âœ“ ${strokeType}æç”»å®Œäº†ï¼ˆ8è»¸å¯¾ç§°ãƒ¢ãƒ¼ãƒ‰ï¼‰- ${strokes.length}å€‹ã®ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã‹ã‚‰${strokes.length * 8}å€‹ã®å¯¾ç§°ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã‚’ç”Ÿæˆ`, 'success');
                } else {
                    renderStrokes(renderer, strokes);
                    updateStatus(`âœ“ ${strokeType}æç”»å®Œäº†ï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰- ${strokes.length}å€‹ã®ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã‚’æç”»`, 'success');
                }
            } catch (error) {
                console.error('æç”»ã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('ã‚¨ãƒ©ãƒ¼: æç”»ã«å¤±æ•—ã—ã¾ã—ãŸ - ' + error.message, 'error');
            }
        }

        function initializeDemo() {
            try {
                // Initialize static test canvas
                renderer = initializeRenderer('test-canvas');
                setDrawingColor(renderer, 0.0, 0.0, 0.0, 1.0);
                
                // Initialize interactive paint app
                paintApp = PaintAppFactory.create({
                    canvasId: 'paint-canvas',
                    displaySize: { width: 500, height: 500 },
                    enableDebug: true
                });
                
                updateStatus('WebGL renderer and Paint App initialized successfully. Both canvases ready!', 'success');
                
            } catch (error) {
                updateStatus(`Failed to initialize: ${error.message}`, 'error');
                console.error('Initialization error:', error);
            }
        }

        // Button event handlers
        document.getElementById('render-all').addEventListener('click', () => {
            try {
                renderTestPattern(renderer, allTestStrokes);
                updateStatus(`Rendered all test strokes (${allTestStrokes.length} strokes)`, 'success');
            } catch (error) {
                updateStatus(`Error rendering all strokes: ${error.message}`, 'error');
            }
        });

        document.getElementById('render-lines').addEventListener('click', () => {
            try {
                clearCanvas(renderer);
                renderStrokes(renderer, allTestStrokes);
                updateStatus(`Rendered ${allTestStrokes.length} strokes as line strips`, 'success');
            } catch (error) {
                updateStatus(`Error rendering lines: ${error.message}`, 'error');
            }
        });

        document.getElementById('render-points').addEventListener('click', () => {
            try {
                clearCanvas(renderer);
                setDrawingColor(renderer, 1.0, 0.0, 0.0, 1.0); // Red points
                renderStrokesAsPoints(renderer, allTestStrokes);
                updateStatus('Rendered all strokes as red points', 'success');
            } catch (error) {
                updateStatus(`Error rendering points: ${error.message}`, 'error');
            }
        });

        document.getElementById('clear-canvas').addEventListener('click', () => {
            try {
                clearCanvas(renderer);
                updateStatus('Canvas cleared', 'success');
            } catch (error) {
                updateStatus(`Error clearing canvas: ${error.message}`, 'error');
            }
        });

        // çµ±åˆæç”»ãƒœã‚¿ãƒ³
        document.getElementById('draw-line').addEventListener('click', () => drawStroke('line'));
        document.getElementById('draw-curve').addEventListener('click', () => drawStroke('curve'));
        document.getElementById('draw-arc').addEventListener('click', () => drawStroke('arc'));
        document.getElementById('draw-multi').addEventListener('click', () => drawStroke('multi'));

        // Live canvas controls
        document.getElementById('clear-live-canvas').addEventListener('click', () => {
            if (paintApp) {
                paintApp.clearCanvas();
                updateStatus('Live canvas cleared', 'success');
            }
        });

        document.getElementById('toggle-symmetry').addEventListener('click', () => {
            if (paintApp) {
                const currentState = document.getElementById('live-symmetry-enabled').checked;
                const newState = !currentState;
                document.getElementById('live-symmetry-enabled').checked = newState;
                paintApp.updateSymmetry(newState, 8);
                updateStatus(`Symmetry mode ${newState ? 'enabled' : 'disabled'}`, 'success');
            }
        });

        document.getElementById('live-symmetry-enabled').addEventListener('change', (e) => {
            if (paintApp) {
                paintApp.updateSymmetry(e.target.checked, 8);
            }
        });

        // =============================================================================
        // INPUT CORRECTION CONTROLS (Task 6.6)
        // =============================================================================

        // Pressure correction toggle
        document.getElementById('pressure-correction-enabled').addEventListener('change', (e) => {
            if (paintApp) {
                paintApp.enablePressureCorrection(e.target.checked);
            }
            updateStatus(`Pressure correction ${e.target.checked ? 'enabled' : 'disabled'}`, 'success');
        });

        // Smoothing toggle
        document.getElementById('smoothing-enabled').addEventListener('change', (e) => {
            // Note: Smoothing is always enabled in ExtendedInputProcessor
            // This toggle could be used to control smoothing strength (0 = disabled)
            if (paintApp) {
                const strength = e.target.checked ? parseFloat(document.getElementById('smoothing-strength-slider').value) : 0.0;
                paintApp.setSmoothingStrength(strength);
            }
            updateStatus(`Smoothing ${e.target.checked ? 'enabled' : 'disabled'}`, 'success');
        });

        // Pen thickness slider
        const penThicknessSlider = document.getElementById('pen-thickness-slider');
        const penThicknessValue = document.getElementById('pen-thickness-value');
        
        penThicknessSlider.addEventListener('input', (e) => {
            const thickness = parseFloat(e.target.value);
            penThicknessValue.textContent = `${thickness}px`;
            if (paintApp) {
                paintApp.setBrushSize(thickness);
            }
            updateStatus(`Pen thickness set to ${thickness}px`, 'success');
        });

        // Smoothing strength slider
        const smoothingStrengthSlider = document.getElementById('smoothing-strength-slider');
        const smoothingStrengthValue = document.getElementById('smoothing-strength-value');
        
        smoothingStrengthSlider.addEventListener('input', (e) => {
            const strength = parseFloat(e.target.value);
            smoothingStrengthValue.textContent = strength.toFixed(1);
            if (paintApp) {
                paintApp.setSmoothingStrength(strength);
            }
            updateStatus(`Smoothing strength set to ${strength}`, 'success');
        });

        // Smoothing method select
        document.getElementById('smoothing-method-select').addEventListener('change', (e) => {
            const method = e.target.value;
            const methodName = method === 'linear' ? 'Linear (é«˜é€Ÿ)' : 'Catmull-Rom (é«˜å“è³ª)';
            if (paintApp) {
                paintApp.setSmoothingMethod(method);
            }
            updateStatus(`Smoothing method changed to ${methodName}`, 'success');
        });

        // Real-time mode toggle
        document.getElementById('realtime-mode-enabled').addEventListener('change', (e) => {
            const mode = e.target.checked ? 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  (é€Ÿåº¦å„ªå…ˆ)' : 'ã‚¯ã‚ªãƒªãƒ†ã‚£ (å“è³ªå„ªå…ˆ)';
            if (paintApp) {
                paintApp.setRealtimeMode(e.target.checked);
            }
            updateStatus(`Mode changed to ${mode}`, 'success');
        });

        // Quality metrics toggle
        const qualityMetricsToggle = document.getElementById('quality-metrics-enabled');
        const qualityMetricsDisplay = document.getElementById('quality-metrics-display');
        
        qualityMetricsToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                qualityMetricsDisplay.style.display = 'block';
                updateQualityMetrics();
                updateStatus('Quality metrics monitoring enabled', 'success');
            } else {
                qualityMetricsDisplay.style.display = 'none';
                updateStatus('Quality metrics monitoring disabled', 'success');
            }
        });

        // Function to update quality metrics display
        function updateQualityMetrics() {
            if (paintApp) {
                const metrics = paintApp.getCorrectionQualityMetrics();
                if (metrics) {
                    document.getElementById('smoothness-improvement').textContent = 
                        (metrics.smoothnessImprovement * 100).toFixed(1) + '%';
                    document.getElementById('pressure-stability').textContent = 
                        (metrics.pressureStability * 100).toFixed(1) + '%';
                    document.getElementById('data-fidelity').textContent = 
                        (metrics.dataFidelity * 100).toFixed(1) + '%';
                    document.getElementById('processing-ratio').textContent = 
                        (metrics.processingRatio * 100).toFixed(1) + '%';
                } else {
                    // Fallback when metrics not available
                    document.getElementById('smoothness-improvement').textContent = 'N/A';
                    document.getElementById('pressure-stability').textContent = 'N/A';
                    document.getElementById('data-fidelity').textContent = 'N/A';
                    document.getElementById('processing-ratio').textContent = 'N/A';
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (renderer) {
                cleanupRenderer(renderer);
            }
            if (paintApp) {
                paintApp.destroy();
            }
        });
    </script>
  </body>
</html>
